message "XML/PTDF/M80_V1.3.xsd" receiving, passthru
! message "XML/PHARMA/DTD/responseAPI.dtd" receiving, passthru

base "syslog.cfg" SYSLOG
base "documenttracker.cfg" TRACE

!===========================================================================================================

#define SYS_SOURCE_ID "PTDF"
#define CODACT "001"
#define VIRTUAL_SEPARATOR(A)	replace(build(number(A):R08.3),".","")	

#include "include/GEEXM41.inc"
 
#define _VERSION_ "1.0.0 01-07-2024"
#define LOG(LOG_label,LOG_value) log("* ",LOG_label:5.5," :",LOG_value,NL)
#define PRINT(LOG_label,LOG_value) print("* ",LOG_label:5.5," :",time ("%d.%m.%y %H:%M:%S")," :",LOG_value,NL)
#define PRINT_FATAL(A) PRINT("FATAL",A)
#define LOG_INFO(A) LOG("INFO",A)
#define LOG_FATAL(A) LOG("FATAL",A)
#define GET_CONF(A)	taPARAM[A]
#define PEEL(A)  peel(A," ")
#define REPLACE(A) replace(A, "\"", " ")

!===========================================================================================================
! Initialization section
begin
	nRec := 1
	nPos := 1
	nMessageID := cMessageID
	
    TRACE := new(build(sHOME,"/documenttracker"))

   	if (pINDEX) <> EMPTY then
		SYSLOG := find(sSYSLOG,INDEX=number(pINDEX))
	endif

    tInputFileName := pFTP.ORIGINAL.FILENAME
	if tInputFileName = EMPTY then
		tInputFileName := pEDISEND.ORIGINAL.NAME
	endif

    ! tNameFile := build("/tmp/DF0MA30",nMessageID,".DAT")
    ! tFileOut := build(sHOME, tNameFile)

	!Inicio do processo
		log("########################################################", NL)
		log("Inicio: ", time("now","%Y-%m-%d %H:%M:%S"), NL)
		log("Arquivo de entrada: ",tInputFileName, NL)
		log("########################################################", NL)

	!Variaveis Gerais
		nCount := 0
		

endbegin

!===========================================================================================================

line(1:"00.00")
	tDATEXC_0000 := S_GEEX0000_DATEXC
	tHEUEXC_0000 := S_GEEX0000_HEUEXC
endline

!===========================================================================================================

line(1:"80.00") ! MOVEMENT

	! Cabeçalho por Variavel
		tCODEXC := S_GEEX8000_CODEXC
		tSEPEXC := S_GEEX8000_SEPEXC
		tSCOEXC := S_GEEX8000_SCOEXC
		tTRTEXC := S_GEEX8000_TRTEXC
		tDATMVT := S_GEEX8000_DATMVT
		tHEUMVT := S_GEEX8000_HEUMVT
		tDATRGL := S_GEEX8000_DATRGL
		tCODMDU := S_GEEX8000_CODMDU
		tCODFON := S_GEEX8000_CODFON
		tCODMVT := S_GEEX8000_CODMVT
		tSENMVT := S_GEEX8000_SENMVT
		tMOTMVT := S_GEEX8000_MOTMVT
		tEDIMVT := S_GEEX8000_EDIMVT
		tREFMVT := S_GEEX8000_REFMVT
		tUVCMVT := S_GEEX8000_UVCMVT
		tCODACT := S_GEEX8000_CODACT
		tCODCLI := S_GEEX8000_CODCLI
		tCODPRO := S_GEEX8000_CODPRO
		tVALPRO := S_GEEX8000_VALPRO
		tCODPRN := S_GEEX8000_CODPRN
		tSPCPRO := S_GEEX8000_SPCPRO
		tPCBPRO := S_GEEX8000_PCBPRO
		tCODSIT := S_GEEX8000_CODSIT
		tZONSTS := S_GEEX8000_ZONSTS
		tALLSTS := S_GEEX8000_ALLSTS
		tDPLSTS := S_GEEX8000_DPLSTS
		tNIVSTS := S_GEEX8000_NIVSTS
		tCODLOT := S_GEEX8000_CODLOT
		tNUMLOT := S_GEEX8000_NUMLOT
		tCODPAL := S_GEEX8000_CODPAL
		tDATFVI := S_GEEX8000_DATFVI
		tNUMDIM := S_GEEX8000_NUMDIM
		tCODTIE := S_GEEX8000_CODTIE
		tTYPTIE := S_GEEX8000_TYPTIE
		tNUMCDE := S_GEEX8000_NUMCDE
		tSNUCDE := S_GEEX8000_SNUCDE
		tCODUTI := S_GEEX8000_CODUTI
		tUNIPRO := S_GEEX8000_UNIPRO

	! Cabeçalho por Variavel

	! Cabeçalho por segmento
		segment STRTEXC gGMOVEMENT
			eETRTEXC := S_GEEX8000_TRTEXC
		endsegment

		segment SDATMVT gGMOVEMENT
			eEDATMVT := S_GEEX8000_DATMVT
		endsegment

		segment SHEUMVT gGMOVEMENT
			eEHEUMVT := S_GEEX8000_HEUMVT
		endsegment

		segment SDATRGL gGMOVEMENT
			eEDATRGL := S_GEEX8000_DATRGL
		endsegment

		segment SCODMDU gGMOVEMENT
			eECODMDU := S_GEEX8000_CODMDU
		endsegment

		segment SCODFON gGMOVEMENT
			eECODFON := S_GEEX8000_CODFON
		endsegment

		segment SCODMVT gGMOVEMENT
			eECODMVT := S_GEEX8000_CODMVT
		endsegment

		segment SSENMVT gGMOVEMENT
			eESENMVT := S_GEEX8000_SENMVT
		endsegment

		segment SMOTMVT gGMOVEMENT
			eEMOTMVT := S_GEEX8000_MOTMVT
		endsegment

		segment SEDIMVT gGMOVEMENT
			eEEDIMVT := S_GEEX8000_EDIMVT
		endsegment

		segment SREFMVT gGMOVEMENT
			eEREFMVT := S_GEEX8000_REFMVT
		endsegment

		segment SUVCMVT gGMOVEMENT
			eEUVCMVT := S_GEEX8000_UVCMVT
		endsegment

		segment SCODACT gGMOVEMENT
			eECODACT := S_GEEX8000_CODACT
		endsegment

		segment SCODCLI gGMOVEMENT
			eECODCLI := S_GEEX8000_CODCLI
		endsegment

		segment SCODPRO gGMOVEMENT
			eECODPRO := S_GEEX8000_CODPRO
		endsegment

		segment SVALPRO gGMOVEMENT
			eEVALPRO := S_GEEX8000_VALPRO
		endsegment

		segment SCODPRN gGMOVEMENT
			eECODPRN := S_GEEX8000_CODPRN
		endsegment

		segment SSPCPRO gGMOVEMENT
			eESPCPRO := S_GEEX8000_SPCPRO
		endsegment

		segment SPCBPRO gGMOVEMENT
			eEPCBPRO := S_GEEX8000_PCBPRO
		endsegment

		segment SCODSIT gGMOVEMENT
			eECODSIT := S_GEEX8000_CODSIT
		endsegment

		segment SZONSTS gGMOVEMENT
			eEZONSTS := S_GEEX8000_ZONSTS
		endsegment

		segment SALLSTS gGMOVEMENT
			eEALLSTS := S_GEEX8000_ALLSTS
		endsegment

		segment SDPLSTS gGMOVEMENT
			eEDPLSTS := S_GEEX8000_DPLSTS
		endsegment

		segment SNIVSTS gGMOVEMENT
			eENIVSTS := S_GEEX8000_NIVSTS
		endsegment

		segment SCODLOT gGMOVEMENT
			eECODLOT := S_GEEX8000_CODLOT
		endsegment

		segment SNUMLOT gGMOVEMENT
			eENUMLOT := S_GEEX8000_NUMLOT
		endsegment

		segment SCODPAL gGMOVEMENT
			eECODPAL := S_GEEX8000_CODPAL
		endsegment

		segment SDATFVI gGMOVEMENT
			eEDATFVI := S_GEEX8000_DATFVI
		endsegment

		segment SNUMDIM gGMOVEMENT
			eENUMDIM := S_GEEX8000_NUMDIM
		endsegment

		segment SCODTIE gGMOVEMENT
			eECODTIE := S_GEEX8000_CODTIE
		endsegment

		segment STYPTIE gGMOVEMENT
			eETYPTIE := S_GEEX8000_TYPTIE
		endsegment

		segment SNUMCDE gGMOVEMENT
			eENUMCDE := S_GEEX8000_NUMCDE
		endsegment

		segment SSNUCDE gGMOVEMENT
			eESNUCDE := S_GEEX8000_SNUCDE
		endsegment

		segment SCODUTI gGMOVEMENT
			eECODUTI := S_GEEX8000_CODUTI
		endsegment

		segment SUNIPRO gGMOVEMENT
			eEUNIPRO := S_GEEX8000_UNIPRO
		endsegment

	! Cabeçalho por segmento

endline


!===========================================================================================================
! Default statements section
default

enddefault

!===========================================================================================================
! End statements section
end
    log("tTRTEXC = ", tTRTEXC, NL)
    log("tCODPRO = ", tCODPRO, NL)

	!print(MESSAGE) >> tFileOutTemp

	log("########################################################", NL)
	log("Fim: ", time("now","%Y-%m-%d %H:%M:%S"), NL)
	log("########################################################", NL)

endend

!===========================================================================================================
